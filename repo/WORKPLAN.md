# План работ VK Dating Telegram Bot (локальный запуск, 2 разработчика)

## Входные требования (обновлённые)
1) Кнопка “Старт”: при старте бот показывает сообщение “Введите токен vk”.
2) Потом "Введите ваш VK_ID"
3) Бот тестирует соединение (валидирует токен).
4) После успешной проверки доступна кнопка “Настроить фильтры поиска”.
5) После нажатия бот задаёт 4 вопроса:
   1) Укажите город для поиска
   2) Укажите пол для поиска кандидатов
   3) Укажите интересующий начальный возраст кандидатов
   4) Укажите интересующий максимальный возраст кандидатов
6) Главный экран:
   - Предыдущий
   - Далее
   - Дополнительно → Добавить в избранное / В чёрный список / Показать избранное → Удалить из избранного / Настроить фильтры
7) Кнопки лайк отсутствуют.

---

## Участники
- Участник A — VK API + Telegram Bot + финальная сборка проекта
- Участник B — БД (PostgreSQL/ORM) + интеграция bot↔db + документация

---

## Этап 1: Подготовка проекта

### Участник A
1) Создать репозиторий GitHub и добавить Участника B (Admin).
2) Создать каркас проекта:
   - `src/`, `scripts/`, `docs/`, `data/`
3) Добавить базовые файлы:
   - `.env.example`
   - `requirements.txt`
   - `.gitignore`
   - `README.md` (локальный запуск)
4) Подготовить структуру Telegram UI:
   - клавиатуры согласно архитектуре кнопок
   - FSM-стейты (WAIT_VK_TOKEN + 4 фильтра + MAIN_SCREEN)

Артефакты:
- Репозиторий + доступы
- Каркас + первичная структура UI

### Участник B
1) Спроектировать БД с учётом новых требований:
   - хранение vk_token и vk_id per tg_user
   - хранение фильтров per tg_user
   - история показов для “Предыдущий/Далее”
   - favorites/blacklist/seen
2) Подготовить `scripts/init_db.sql` (создание таблиц).
3) Описать таблицы в `docs/db_schema.md`.

Артефакты:
- SQL скрипт
- Документация по БД

---

## Этап 2: Реализация модулей

### Участник A — VK интеграция и токен-тест
1) VK client + методы:
   - users.get (проверка токена)
   - users.search
   - photos.get
   - city resolve (получение city_id по названию)
2) Реализовать AuthService.test_vk_token:
   - проверить токен с vk_id
   - вернуть vk_user_id
3) Реализовать построение attachments для 3 фото.

Артефакты:
- `src/infrastructure/vk/*`
- `src/application/services/auth_service.py`

### Участник B — DB + репозитории + история
1) Реализовать таблицы:
   - tg_user (vk_token + vk_id + фильтры)
   - seen_profile
   - favorite_profile
   - blacklist_profile
   - view_history (для “Предыдущий/Далее”) или history cursor
2) Реализовать репозитории:
   - upsert tg_user + обновление токена
   - update filters
   - push history / prev/next
   - CRUD favorites/blacklist/seen

Артефакты:
- `src/infrastructure/db/models.py`
- `src/infrastructure/db/repositories.py`
- обновлённый `scripts/init_db.sql`

---

## Этап 3: Telegram сценарии и интеграция

### Участник A — Telegram UI и FSM
1) /start → “Введите токен vk” → WAIT_VK_TOKEN
2) “Введите vk ID” → WAIT_VK_ID
3) При получении токена и ID:
   - вызвать AuthService.test_vk_token
   - показать “Настроить фильтры поиска”
4) “Настроить фильтры”:
   - 4 вопроса (FSM)
   - по завершению — MAIN_SCREEN
5) MAIN_SCREEN:
   - Предыдущий/Далее/Дополнительно
6) Дополнительно:
   - Добавить в избранное
   - В чёрный список
   - Показать избранное → Удалить

Артефакты:
- `src/presentation/tg/*`

### Участник B — Интеграция и документация
1) Связать Telegram сценарии с БД:
   - сохранить токен c vk_id
   - сохранить фильтры
   - history prev/next
   - favorites/blacklist/seen
2) Обновить/дописать документы:
   - `ARCHITECTURE.md`
   - `docs/user_manual.md`
   - `docs/db_schema.md`
   - `docs/vk_api_notes.md`
3) Финальные фиксы.

---

## Definition of Done (готово)
1) /start просит VK токен и vk_id.
2) Токен и id проверяется через VK API.
3) После проверки доступны “Настроить фильтры” и 4 вопроса.
4) Главный экран: Предыдущий/Далее/Дополнительно.
5) Избранное/ЧС работают и хранятся в БД.
6) Предыдущий/Далее работают через локальную историю показов.
7) Таблицы создаются через `scripts/init_db.sql`.
8) Документации достаточно для проверки.
